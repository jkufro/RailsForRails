
simplecov:
  stage: test
  image: docker.io/rails:5
  script:
    - apt-get update -qy
    - apt-get install -y nodejs
    - bundle install --path /cache
    - bundle exec rake db:create RAILS_ENV=test
    - bundle exec rake test
  artifacts:
    paths:
      - coverage/
  variables:
    GIT_SSL_NO_VERIFY: "true"
  # only:
  #   - master

pages:
  stage: deploy
  dependencies:
    - simplecov
  script:
    - mv coverage/ public/
  artifacts:
    paths:
      - public
    expire_in: 30 days
  # only:
  #   - master
